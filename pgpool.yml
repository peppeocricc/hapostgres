- name: Install python
  hosts: "{{ node }}"
  gather_facts: no
  
  tasks:
  - name: Fail if this node is not a pgpool
    fail:
      msg: "This playbook must be run on pgp0, pgp1 or pgp2"
    when:
      not inventory_hostname in ["pgp0","pgp1","pgp2"]

  - name: Install python
    raw: yum install -y python2 

- name: Install and configure pgpool
  hosts: "{{ node }}"
  gather_facts: yes
  
  tasks:
  - name: Set somaxconn in sysctl.conf
    ansible.posix.sysctl:
      name: net.core.somaxconn
      value: '{{ somaxconn }}'
      state: present
      reload: yes

  - name: Install and configure	pgpool
    include_role:
      name: pgpool
